import random
import itertools
import time
import datetime

class Kaart:
    # Maakt een klasse kaart met methodes die kunnen checken of het een set is, een willekeurige kaart kunnen geven
    # en een string kan geven zodat het bestand met de afbeelding gevonden kan worden
    def __init__(self, kleur, vorm, vulling, aantal):
        self.kleur = kleur
        self.vorm = vorm
        self.vulling = vulling
        self.aantal = aantal

    def is_set(self, kaart2):
        if (self.aantal == kaart2.aantal) or (self.aantal != kaart2.aantal):
            if (kaart2.kleur == self.kleur) or (kaart2.kleur != self.kleur):
                if (kaart2.vorm == self.vorm) or (kaart2.vorm != self.vorm):
                    if (kaart2.vulling == self.vulling) or (kaart2.vulling != self.vulling):
                        return True
        return False
    
    def geef_willekeurige_kaart(stack_kaarten):
        willekeurige_kaart = random.choice(stack_kaarten)
        return willekeurige_kaart
    
    def is_set_helemaal(kaart1, kaart2, kaart3):
        return kaart1.is_set(kaart2) and kaart1.is_set(kaart3) and kaart2.is_set(kaart3)
    
    def wijs_naam_toe(self):
        kleur_naam = {
            0 == "green",
            1 == "purple",
            2 == "red"
            }
        vorm_naam = {
            0 == "diamond",
            1 == "oval",
            2 == "squiggle"
        }
        vulling_naam = {
            0 == "empty",
            1 == "shaded",
            2 == "filled"
        }
        aantal_naam = {
            0 == "1",
            1 == "2",
            2 == "3"
        }
        naam_bestand = kleur_naam[self.kleur] + vorm_naam[self.naam] + vulling_naam[self.vulling] + aantal_naam[self.aantal]
        return naam_bestand
    
class Speelveld:
    # Maakt een klasse speelveld die alle mogelijke kaarten bevat, een speelveld kan maken, sets kan zoeken
    # en eventueel extra kaarten kan toevoegen als er geen set is.
    def __init__(self):
        self.veld = []
        self.aantal_startkaarten = 12
        self.stack_kaarten = list(itertools.product((0,1,2), repeat=4))
    
    def maak_speelveld(self):
        self.veld = list(random.choice(self.stack_kaarten, self.aantal_startkaarten))
        Speelveld.verwijder_kaarten(self.veld)
        return self.veld

    def zoek_set(self):
            mogelijke_sets = []
            for i in range(len(self.veld)):
                for j in range(i + 1, len(self.veld)):
                    for k in range(j + 1, len(self.veld)):
                        kaart1 = self.veld[i]
                        kaart2 = self.veld[j]
                        kaart3 = self.veld[k]
                        if Kaart.is_set_helemaal(kaart1, kaart2, kaart3):
                            mogelijke_sets.append([kaart1,kaart2,kaart3])
            return mogelijke_sets

    def extra_kaarten_speelveld(self):
        self.veld += [Kaart(*Kaart.geef_willekeurige_kaart(self.stack_kaarten)) for _ in range(3)]
        Speelveld.verwijder_kaarten(self.veld)
    
    def verwijder_kaarten(self, kaart):
        for i in kaart:
            if kaart[i] in self.stack_kaarten:    
                self.stack_kaarten.pop[i]

    def nieuw_speelveld(self):
        self.stack_kaarten = list(itertools.product((0,1,2), repeat=4))
        Speelveld.maak_speelveld(self.aantal_startkaarten)

class Spel:
    # Beschrijft de onderdelen van het spel en de mogelijke acties.
    def __init__(self):
        self.speler = 0
        self.computer = 0
        self.moeilijkheid = 30
    
    def start_spel(self):
        Speelveld.maak_speelveld()
        Spel.timer(self.moeilijkheid)

    def timer(self, moeilijkheid):
        tijd = moeilijkheid
        while tijd > 0:
            timer = datetime.timedelta(seconds = moeilijkheid)
            #visualiseer timer
            print(timer, end="\r")
            time.sleep(1)
            tijd -=1
        if len(Speelveld.zoek_set()) == False:
            Speelveld.extra_kaarten_speelveld()
        else:
            Spel.punt_toewijzen(self.computer)

    def punt_toewijzen(punten):
        punten +=1
        return punten

    def check_selectie(self, selectie1, selectie2, selectie3):
        if Kaart.is_set_helemaal(selectie1, selectie2, selectie3):
            setje = [selectie1, selectie2, selectie3]
            Spel.timer(self.moeilijkheid)
            Speelveld.verwijder_kaarten(setje)
            Speelveld.extra_kaarten_speelveld()
            Spel.punt_toewijzen(self.speler)
        else:
            Spel.punt_toewijzen(self.computer)

    def nieuw_spel(self):
        self.speler = 0
        self.computer = 0
        Speelveld.nieuw_speelveld()
        Spel.timer(self.moeilijkheid)

